<!-- Connection Requests Management -->
<ng-container *ngFor="let section of [
  { key: 'sentRequests', title: 'Sent Requests', list: sentRequests, sent: true, icon: 'ðŸ“¤' },
  { key: 'receivedRequests', title: 'Received Requests', list: receivedRequests, sent: false, icon: 'ðŸ“¥' }
]">
  <section 
    *ngIf="activeTab === section.key" 
    class="animate-fade-in"
    role="region" 
    [attr.aria-labelledby]="section.key + '-title'">
    
    <header class="mb-6">
      <div class="flex items-center gap-3 mb-2">
        <span class="text-2xl" aria-hidden="true">{{ section.icon }}</span>
        <h3 [id]="section.key + '-title'" class="text-2xl font-bold text-gray-800">{{ section.title }}</h3>
      </div>
      <p class="text-gray-600">
        {{ section.sent ? 'Requests you\'ve sent to other users' : 'Requests from other users to connect with you' }}
      </p>
    </header>

    <!-- Empty State -->
    <div *ngIf="!section.list?.length" class="text-center py-12 bg-gray-50 rounded-xl">
      <div class="text-6xl mb-4">{{ section.icon }}</div>
      <h4 class="text-xl font-medium text-gray-700 mb-2">
        {{ section.sent ? 'No sent requests' : 'No received requests' }}
      </h4>
      <p class="text-gray-500">
        {{ section.sent ? 'You haven\'t sent any connection requests yet' : 'You don\'t have any pending connection requests' }}
      </p>
    </div>

    <!-- Requests List -->
    <ul *ngIf="section.list?.length" class="space-y-4" role="list">
      <li 
        *ngFor="let req of section.list; trackBy: trackByRequestId" 
        class="bg-white p-6 rounded-xl shadow hover:shadow-lg transition-shadow">
        
        <div class="flex flex-col md:flex-row gap-4 items-start md:items-center justify-between">
          <!-- User Information -->
          <div class="flex items-center gap-4 flex-1">
            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0" aria-hidden="true">
              <span class="text-lg text-blue-600 font-bold">{{ req.name.charAt(0) }}</span>
            </div>
            
            <div class="flex-1 min-w-0">
              <h4 class="font-semibold text-gray-800 text-lg mb-1">{{ req.name }}</h4>
              <div class="flex flex-wrap gap-2 text-sm text-gray-600">
                <span *ngIf="req.role">{{ req.role }}</span>
                <span *ngIf="req.company" class="text-gray-500">â€¢ {{ req.company }}</span>
                <span *ngIf="req.location" class="text-gray-500">â€¢ {{ req.location }}</span>
              </div>
              <p *ngIf="req.message" class="text-gray-600 mt-2 text-sm italic">"{{ req.message }}"</p>
            </div>
          </div>

          <!-- Action Buttons and Status -->
          <div class="flex flex-col sm:flex-row gap-3 items-end sm:items-center">
            <!-- Sent Requests: Status Badge and Actions -->
            <ng-container *ngIf="section.sent">
              <div class="flex items-center gap-3">
                <span 
                  [ngClass]="getStatusBadgeClasses(req.status)"
                  class="px-3 py-1 rounded-full text-xs font-semibold">
                  {{ req.status }}
                </span>
                
                <button 
                  *ngIf="req.status === 'Pending'"
                  type="button"
                  (click)="cancelRequest(req.id)"
                  class="text-red-600 hover:text-red-700 hover:underline font-medium text-sm transition-colors"
                  [attr.aria-label]="'Withdraw request to ' + req.name">
                  Withdraw
                </button>
              </div>
            </ng-container>

            <!-- Received Requests: Accept/Decline Actions -->
            <ng-container *ngIf="!section.sent">
              <ng-container *ngIf="req.status === 'Pending'; else statusBadge">
                <div class="flex gap-2">
                  <button 
                    type="button"
                    (click)="acceptRequest(req.id)"
                    class="bg-green-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-400 focus:ring-offset-2 transition-colors"
                                         [attr.aria-label]="'Accept connection request from ' + req.name">
                    Accept
                  </button>
                  <button 
                    type="button"
                    (click)="rejectRequest(req.id)"
                    class="bg-red-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-offset-2 transition-colors"
                                         [attr.aria-label]="'Decline connection request from ' + req.name">
                    Decline
                  </button>
                </div>
              </ng-container>
              
              <ng-template #statusBadge>
                <span 
                  [ngClass]="getStatusBadgeClasses(req.status)"
                  class="px-3 py-1 rounded-full text-xs font-semibold">
                  {{ req.status }}
                </span>
              </ng-template>
            </ng-container>
          </div>
        </div>

        <!-- Request Details -->
        <div class="mt-4 pt-4 border-t border-gray-100 text-sm text-gray-500">
          <div class="flex flex-wrap gap-4">
            <span>Sent: {{ req.sentDate | date:'mediumDate' }}</span>
            <span *ngIf="req.respondedDate">Responded: {{ req.respondedDate | date:'mediumDate' }}</span>
          </div>
        </div>
      </li>
    </ul>
  </section>
</ng-container>
